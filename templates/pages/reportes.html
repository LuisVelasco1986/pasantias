{% extends "pages/dashboard.html" %}
{% load static %}

{% block dashboard_content %}

<div class="sectionTitle mb-4">Reportes</div>
<form method="get" class="">
<!-- =========================
    SECCIÃ“N 1: FILTROS
========================= -->
<div class="card mb-4">
    <div class="card-body">

        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Desde</label>
                <input type="date" name="desde" class="form-control" value="{{ request.GET.desde }}">
            </div>

            <div class="col-md-3">
                <label class="form-label">Hasta</label>
                <input type="date" name="hasta" class="form-control" value="{{ request.GET.hasta }}">
            </div>

            <div class="col-md-3">
                <label class="form-label">Tipo de persona</label>
                <select name="tipo" class="form-select">
                    <option value="">Todos</option>
                    {% for tipo in tipos %}
                    <option value="{{ tipo.nombre_tipo }}" {% if request.GET.tipo == tipo.nombre_tipo %}selected{% endif %}>
                        {{ tipo.nombre_tipo }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <label class="form-label">Departamento</label>
                <select name="departamento" class="form-select">
                    <option value="">Todos</option>
                    {% for dep in departamentos %}
                    <option value="{{ dep.nombre }}" {% if request.GET.departamento == dep.nombre %}selected{% endif %}>
                        {{ dep.nombre }}
                    </option>
                    {% endfor %}
                </select>
            </div>


            <div class="col-md-3 d-grid align-items-end">
                <div class="d-flex gap-2">
                    <button class="btn btn-primary w-100">
                        Generar reporte
                    </button>

                    <a href="{% url 'modelNewApp:reportes' %}" class="btn btn-outline-secondary w-100">
                        Borrar filtros
                    </a>
                </div>
            </div>

        </div>

    </div>
</div>

<!-- =========================
    SECCIÃ“N 2: TIPO DE REPORTE
========================= -->

<div class="card mb-4">
    <div class="card-body">
        <h5 class="mb-3">Tipo de reporte</h5>

        <div class="row g-3">

            <div class="col-md-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reporte" value="accesos" {% if request.GET.reporte == "accesos" or not request.GET.reporte %}checked{% endif %}>
                    <label class="form-check-label">
                        Accesos detallados
                    </label>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reporte" value="personas" {% if request.GET.reporte == "personas" %}checked{% endif %}>
                    <label class="form-check-label">
                        Resumen por persona
                    </label>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reporte" value="diario" {% if request.GET.reporte == "diario" %}checked{% endif %}>
                    <label class="form-check-label">
                        Resumen diario
                    </label>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reporte" value="tipo" {% if request.GET.reporte == "tipo" %}checked{% endif %}>
                    <label class="form-check-label">
                        Por tipo de persona
                    </label>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio"
                           name="reporte" value="departamento" {% if request.GET.reporte == "departamento" %}checked{% endif %}>
                    <label class="form-check-label">
                        Resumen por departamento
                    </label>
                </div>
            </div>


        </div>
    </div>
</div>

<!-- =========================
    SECCIÃ“N 3: FORMATO DE SALIDA
========================= -->

<div class="card mb-4">
    <div class="card-body">
        <h5 class="mb-3">Formato</h5>

        <div class="row g-3">

            <div class="col-md-2">
                <button name="formato" value="pdf" class="btn btn-outline-secondary w-100">
                    ðŸ“„ PDF
                </button>

            </div>

            <div class="col-md-2">
                <button name="formato" value="excel" class="btn btn-outline-secondary w-100">
                    ðŸ“Š Excel
                </button>
            </div>

            <div class="col-md-2">
                <button name="formato" value="csv" class="btn btn-outline-secondary w-100">
                    ðŸ“‹ CSV
                </button>
            </div>

        </div>
    </div>
</div>
</form>
<!-- =========================
    SECCIÃ“N 4: VISTA PREVIA
========================= -->
<div class="card">
    <div class="card-body">
        <h5 class="mb-3">Vista previa</h5>

        {% if resultados %}
            <div class="table-responsive">
                <table class="table table-hover align-middle">

                    <thead>
                        <tr>
                            {% for col in columnas %}
                                <th>{{ col }}</th>
                            {% endfor %}
                        </tr>
                    </thead>

                    <tbody>
                        {% for fila in page_obj %}
                        <tr>
                            {% for key, value in fila.items %}
                                <td>
                                    {% if value %}
                                        {{ value }}
                                    {% else %}
                                        â€”
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>
        {% if page_obj.paginator.num_pages > 1 %}
        <nav class="mt-3">
            <ul class="pagination justify-content-center">

                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link"
                       href="?{{ request.GET.urlencode }}&page={{ page_obj.previous_page_number }}">
                        Anterior
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link">Anterior</span>
                </li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                    {% elif num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
                        <li class="page-item">
                            <a class="page-link"
                               href="?{{ request.GET.urlencode }}&page={{ num }}">
                                {{ num }}
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link"
                       href="?{{ request.GET.urlencode }}&page={{ page_obj.next_page_number }}">
                        Siguiente
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link">Siguiente</span>
                </li>
                {% endif %}

            </ul>
        </nav>
        {% endif %}

        {% else %}
            <div class="text-muted text-center py-5">
                No hay resultados para los filtros seleccionados
            </div>
        {% endif %}
    </div>
</div>



{% endblock %}